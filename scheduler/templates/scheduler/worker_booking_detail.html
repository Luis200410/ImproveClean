{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrastyle %}
{{ block.super }}
<style>
  body {
    background: linear-gradient(135deg, #f6f9ff 0%, #eef4ff 60%, #e0ebff 100%);
  }
  .booking-layout {
    display: flex;
    gap: 1.5rem;
    max-width: 1100px;
    margin: 2rem auto;
  }
  .booking-detail-card {
    flex: 2;
    background: #fff;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(15, 52, 96, 0.15);
    border: 1px solid rgba(15, 52, 96, 0.08);
  }
  .booking-sidebar {
    flex: 1;
    background: #fff;
    border-radius: 20px;
    padding: 1.5rem;
    box-shadow: 0 18px 36px rgba(15, 52, 96, 0.12);
    border: 1px solid rgba(15, 52, 96, 0.08);
  }
  .booking-detail-meta dt {
    font-weight: 600;
    color: #0f1f3d;
  }
  .booking-detail-meta dd {
    margin-bottom: 0.9rem;
    color: #54627a;
  }
  .response-actions form {
    display: block;
    margin-bottom: 0.75rem;
  }
  .response-actions form:last-child {
    margin-bottom: 0;
  }
  .response-actions button {
    width: 100%;
    border: none;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    font-weight: 600;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .booking-btn {
    width: 100%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: none;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    font-weight: 600;
    color: #fff;
    background: linear-gradient(135deg, #1d8cf8, #3358f4);
    box-shadow: 0 14px 24px rgba(29, 140, 248, 0.25);
  }
  .booking-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 20px 32px rgba(29, 140, 248, 0.3);
  }
  .booking-btn:active {
    transform: translateY(0);
  }
  .booking-btn.decline {
    background: linear-gradient(135deg, #ff6f61, #d9534f);
    box-shadow: 0 14px 24px rgba(217, 83, 79, 0.25);
  }
  .booking-btn.reset {
    background: linear-gradient(135deg, #f8f9fc, #eef1f9);
    color: #3358f4;
    box-shadow: 0 10px 18px rgba(51, 88, 244, 0.15);
  }
  .booking-btn.reset:hover {
    color: #1d8cf8;
  }
  .back-actions {
    margin-top: 1.5rem;
    text-align: center;
  }
  @media (max-width: 991px) {
    .booking-layout {
      flex-direction: column;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="booking-layout">
  <div class="booking-detail-card">
    <h1 class="h3 mb-3">{% trans "Assignment details" %}</h1>
    <p class="text-muted">{% trans "Review the visit information and choose whether to accept or decline this job." %}</p>

    <dl class="booking-detail-meta">
      <dt>{% trans "Worker" %}</dt>
      <dd>{% if booking.worker %}{{ booking.worker.name }}{% else %}{% trans "Unassigned" %}{% endif %}</dd>

      <dt>{% trans "Scheduled for" %}</dt>
      <dd>{{ booking.scheduled_for|date:"l, M d, Y H:i" }}</dd>

      <dt>{% trans "Service" %}</dt>
      <dd>{{ booking.get_service_type_display }}</dd>

      <dt>{% trans "Client" %}</dt>
      <dd>
        {{ booking.user.get_full_name|default:booking.user.username }}
        {% if booking.user.email %}
        · <a href="mailto:{{ booking.user.email }}">{{ booking.user.email }}</a>
        {% endif %}
      </dd>

      <dt>{% trans "Address" %}</dt>
      <dd>{{ booking.address }}</dd>

      {% if booking.notes %}
      <dt>{% trans "Notes" %}</dt>
      <dd>{{ booking.notes }}</dd>
      {% endif %}

      <dt>{% trans "Rush cleaning" %}</dt>
      <dd>{% if booking.rush_cleaning %}{% trans "Yes - high priority" %}{% else %}{% trans "No" %}{% endif %}</dd>

      <dt>{% trans "Current booking status" %}</dt>
      <dd>{{ booking.get_status_display }}</dd>

      <dt>{% trans "Your response" %}</dt>
      <dd>{{ booking.get_worker_response_display }}</dd>
    </dl>
  </div>

  <div class="booking-sidebar">
    <h2 class="h5">{% trans "Respond" %}</h2>
    <p class="text-muted">{% trans "Let the team know if you’re taking this job." %}</p>
    <div class="response-actions">
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="accept" />
        {% if back_url %}<input type="hidden" name="next" value="{{ back_url }}" />{% endif %}
        <button type="submit" class="booking-btn">{% trans "Accept assignment" %}</button>
      </form>
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="decline" />
        {% if back_url %}<input type="hidden" name="next" value="{{ back_url }}" />{% endif %}
        <button type="submit" class="booking-btn decline">{% trans "Decline" %}</button>
      </form>
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="reset" />
        {% if back_url %}<input type="hidden" name="next" value="{{ back_url }}" />{% endif %}
        <button type="submit" class="booking-btn reset">{% trans "Reset to pending" %}</button>
      </form>
    </div>
    {% if back_url %}
    <div class="back-actions">
      <a class="btn btn-link" href="{{ back_url }}">{% trans "Back" %}</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
